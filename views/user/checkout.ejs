<!DOCTYPE html>
<html lang="en">

<head>
	<title></title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap"
		rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap" rel="stylesheet">

	<link rel="stylesheet" href="../user/css/open-iconic-bootstrap.min.css">
	<link rel="stylesheet" href="../user/css/animate.css">

	<link rel="stylesheet" href="../user/css/owl.carousel.min.css">
	<link rel="stylesheet" href="../user/css/owl.theme.default.min.css">
	<link rel="stylesheet" href="../user/css/magnific-popup.css">

	<link rel="stylesheet" href="../user/css/aos.css">

	<link rel="stylesheet" href="../user/css/ionicons.min.css">

	<link rel="stylesheet" href="../user/css/bootstrap-datepicker.css">
	<link rel="stylesheet" href="../user/css/jquery.timepicker.css">


	<link rel="stylesheet" href="../user/css/flaticon.css">
	<link rel="stylesheet" href="../user/css/icomoon.css">
	<link rel="stylesheet" href="../user/css/style.css">
</head>


<section class="ftco-section">
	<form action="" id="placeorderform">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-xl-7 ftco-animate">
					<form class="billing-form" id="addressform" method="get">
						<h3 class="mb-4 billing-heading">Billing Details</h3>
						<div class="row align-items-end">
							<div class="col-md-6">
								<div class="form-group">
									<label for="firstname">First Name</label>
									<input type="text" class="form-control" placeholder="" name="firstname"
										id="firstname" required>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="lastname">Last Name</label>
									<input type="text" class="form-control" placeholder="" name="lastname"
										id="lastname" required>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="lastname">State</label>
									<input type="text" class="form-control" placeholder="" name="state" id="state" required>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="phone">Phone</label>
									<input type="number" class="form-control" placeholder="" name="phone" id="phone" required>
									<input type="text" name="userid" value='<%= userData._id %>' hidden>
								</div>
							</div>

							<div class="w-100"></div>
							<div class="w-100"></div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="streetaddress">Street Address</label>
									<input type="text" class="form-control" placeholder="House number and street name"
										name="street" id="street" required>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<input type="text" class="form-control"
										placeholder="Appartment, suite, unit etc: (optional)" name="appartment"
										id="appartment" required>
								</div>
							</div>
							<div class="w-100"></div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="towncity">Town / City</label>
									<input type="text" class="form-control" placeholder="" name="city" id="city" required>
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="postcodezip">Postcode / ZIP *</label>
									<input type="number" class="form-control" placeholder="" name="zip" id="zip" required>
								</div>
							</div>
							<div class="w-100"></div>
							<div class="col-md-6">

							</div>
							<div class="col-md-6">
							</div>
							<div class="w-100"></div>
							<div class="col-md-12">

							</div>
						</div>
					</form><!-- END -->
				</div>
				<div class="col-xl-5">
					<div class="row mt-5 pt-3">
						<div class="col-md-12 d-flex mb-5">
							<div class="cart-detail cart-total p-3 p-md-4">
								<h3 class="billing-heading mb-4">Cart Total</h3>
								<p class="d-flex">
									<span>Subtotal</span>
									<span>INR <%= total %></span>
								</p>
								<p class="d-flex">
									<span>Delivery</span>
									<span>5%</span>
								</p>
								
								<p class="d-flex total-price">
									<span>Total</span>
									<span id="finalprice"><%= price %></span>
								</p>
							</div>
						</div>
						<div class="col-md-12">
							<div class="cart-detail p-3 p-md-4">
								<h3 class="billing-heading mb-4">Payment Method</h3>
								<div class="form-check"> 
									<input class="form-check-input " type="radio" name="payment_method" id="online_payment" value="online_payment" required>
									<h5><label class="form-check-label " for="online_payment">
										Online Payment 
									  </label></h5>
								  </div>
								  <div class="form-check">
									<input class="form-check-input " type="radio" name="payment_method" id="cash_on_delivery" value="cash_on_delivery"  required>
									<h5><label class="form-check-label " for="cash_on_delivery">
										Cash On Delivery
									   </label></h5>
								  </div>
								<p><button type="submit" class="btn btn-primary mt-4 py-3 px-4">Place an order</button></p>
							</div>
						</div>
					</div>
				</div> <!-- .col-md-8 -->
			</div>
		</div>
	</form>
</section> <!-- .section -->

<%-include('../partials/user-footer') %>



<!-- loader -->
<div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
		<circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
		<circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
			stroke="#F96D00" />
	</svg></div>


<script src="../user/js/jquery.min.js"></script>
<script src="../user/js/jquery-migrate-3.0.1.min.js"></script>
<script src="../user/js/popper.min.js"></script>
<script src="../user/js/bootstrap.min.js"></script>
<script src="../user/js/jquery.easing.1.3.js"></script>
<script src="../user/js/jquery.waypoints.min.js"></script>
<script src="../user/js/jquery.stellar.min.js"></script>
<script src="../user/js/owl.carousel.min.js"></script>
<script src="../user/js/jquery.magnific-popup.min.js"></script>
<script src="../user/js/aos.js"></script>
<script src="../user/js/jquery.animateNumber.min.js"></script>
<script src="../user/js/bootstrap-datepicker.js"></script>
<script src="../user/js/scrollax.min.js"></script>
<script
	src="../user/https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
<script src="../user/js/google-map.js"></script>
<script src="../user/js/main.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
	 $("#placeorderform").submit((e)=>{
            e.preventDefault()
			let price=document.getElementById("finalprice").innerHTML
			console.log(price);
            $.ajax({
                url:'/placeorder?finalprice=' + price,
                method:'post',
                data:$('#placeorderform').serialize(),
                success:(response)=>{
                    if(response.codSuccess)
                    {
						swal({
						text: "PRODUCT ADDED TO WISHLIST",
						icon: "success",
						button: "OK"
					})
                        location.href ='/orderplacedpage'
                    }
                    else
                    {
                        razorpayPayment(response)
                    }
                }
            })
        })

		function razorpayPayment(order){
            console.log('/////     order   ////////    ',order);
            var options = {
                    "key": "rzp_test_wpBmeoeqXZ8EQl", // Enter the Key ID generated from the Dashboard
                    "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                    "currency": "INR",
                    "name": "PROJECTWATCH",
                    "description": "Test Transaction",
                     "image": "https://example.com/your_logo",
                     "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                    "callback_url": "https://eneqd3r9zrjok.x.pipedream.net/",
                    "handler":function(response){

                        verifyPayment(response,order)
                    },
					"prefill":{
						"name":"Hasanul Banna",
						"email":"hasanulbanna2255@gmail.com",
						"contact":"9746082005"


					},
                    "notes": {
                             "address": "Razorpay Corporate Office"
                              },
                    "theme": {
                             "color": "#3399cc"
                             }
             };
            var rzp1 = new Razorpay(options);
            rzp1.open();
        }

		function verifyPayment(payment,order,){
            $.ajax({
                url:'/verifyPayment',
                data:{
                    payment,
                    order
                },
                method:'post',
                success:(response)=>{
                    if(response.status)
                    {
                        swal({
                            text: "PAYMENT SUCCESSFUL",
                            icon: "success",
                            button:"OK"
                         }).then(val=>{
                            if(val)
                            {
                                location.href ='/orderPlacedPage'
                            }
                         })
                    }
                    else
                    {
						swal({
                             text: "PAYMENT FAILED",
                             icon: "error",
                             button:"OK"
                            })
                    }
                }
            })
        }
</script>

</body>

</html>